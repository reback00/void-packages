# Template file for 'textadept'
pkgname=textadept
version=10.8
revision=1
wrksrc="textadept-textadept_${version}"
build_wrksrc="src"
hostmakedepends="autoconf automake libtool wget unzip pkg-config glib-devel ncurses"
makedepends="gtk+-devel ncurses-devel"
short_desc="Fast, minimalist, and extensible text editor for programmers"
maintainer="reback00 <reback00@protonmail.com>"
license="MIT"
homepage="https://foicica.com/textadept/"
distfiles="https://github.com/rgieseke/textadept/archive/textadept_${version}.tar.gz
 https://foicica.com/textadept/download/textadept_${version}.modules.zip"
checksum="33d5c2eb36c93f48af2fa9fe6ae81ab2592b95af2fbe4f45144cd5b6d8a34ce0
 2b2a94f43129ca81d67fde0b206fcd96e352b09a7f687833baa4ee8c5e46b32c"

pre_configure() {
	# For cross builds
	vsed -i \
		-e 's/CC = /CC ?= /' \
		-e 's/CFLAGS = /CFLAGS ?= /' \
		-e 's/CXX = /CXX ?= /' \
		-e 's/CXXFLAGS = /CXXFLAGS ?= /' Makefile
	make deps
}

do_build() {
	make ${makejobs}
	make ${makejobs} curses
}

do_install() {
	make PREFIX=/usr DESTDIR="${DESTDIR}" install
	make curses PREFIX=/usr DESTDIR="${DESTDIR}" install

	# Binaries in /usr/share/textadept are not allowed
	# So we relocate to /usr/lib/textadept
	mkdir -p "${DESTDIR}/usr/lib/"
	mv "${DESTDIR}/usr/share/textadept" "${DESTDIR}/usr/lib/textadept"
	ln -sf "/usr/lib/textadept/textadept" "${DESTDIR}/usr/bin/textadept"
	ln -sf "/usr/lib/textadept/textadept-curses" "${DESTDIR}/usr/bin/textadept-curses"

	# For icons
	mkdir -p "${DESTDIR}/usr/share/pixmaps"
	ln -s "/usr/lib/textadept/core/images/textadept.svg" "${DESTDIR}/usr/share/pixmaps/textadept.svg"
	ln -s "/usr/lib/textadept/core/images/ta_48x48.png" \
		"${DESTDIR}/usr/share/pixmaps/textadept.png"

	vlicense ../LICENSE
}
