# Template file for 'lbry-desktop'
pkgname=lbry-desktop
version=0.48.1
revision=1
archs="x86_64"
hostmakedepends="nodejs yarn-bin binutils tar xz git python libsecret"
depends="nodejs gnome-keyring GConf"
short_desc="Browser for decentralized videos and content available on LBRY protocol"
maintainer="reback00 <reback00@protonmail.com>"
license="MIT"
homepage="https://lbry.com/"
distfiles="https://github.com/lbryio/lbry-desktop/archive/v${version}.tar.gz"
checksum=cc6a93913c69477e9bd67c50f678927e824237be386348199eb885b9ab40c7cb
patch_args="-Np1"

nopie=yes
nodebug=yes
nostrip=yes
noverifyrdeps=yes
noshlibprovides=yes
preserve=yes

pre_build() {
	# To fix node-gyp related error
	# https://stackoverflow.com/a/55590251
	rm yarn.lock

	yarn add core-js@2
}

do_build() {
	yarn build
}

do_install() {
	ar x dist/electron/LBRY_${version}.deb data.tar.xz
	tar xf data.tar.xz -C ${DESTDIR}
}

post_install() {
	vlicense LICENSE
}
